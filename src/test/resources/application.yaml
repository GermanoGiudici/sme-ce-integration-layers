spring:
  datasource:
    driver-class-name: org.mariadb.jdbc.Driver
    username: root
    url: jdbc:mariadb://localhost:3306/cartaesercito
    password: Entando2022
  jpa:
    hibernate:
      naming:
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
      ddl-auto: validate
smece:
  config:
    soggetto:
      rifStato: 5 #tabTipoStatoSoggetto
    istanza:
      rifCanale: 1  # da dove proveniene inserimento (web = aggate, ops = strutture)
      rifOperatore: 1   # tab login operatore che lavora la richiesta
      rifStatoIstanza: 2 # tipologica tabstato istanza(dump)
      nucleoPrincipale: 1 # non presente in tab istanza (a quale tab si riferisce)
      itegrNucleoPrincipale: 3  # modifiche dati di nucleo principale già inserito
      nucleoEsterno: 4 #a quale tab si riferisce
      integrNucleoEsterno: 5 # modifiche dati di nucleo principale già inserito
    mandato:
      rifOperatore: 1
      rifOperatorePagamento: 1 #chi convalida il pagamento
      rifStatoMandato: 1 # stato del mandato (dump)
      rifTipoPagamento: 1 # modalità pagamento (dump)
    costi:
      perSponsor: 800
      perFamigliare: 400
      perOspite: 800 #1000 8euro per nuclei esterni
      spedizione: 450
      limiteNucleoFamigliarePrincipaleNoSponsor: 2000
    query:
      carteEsercitoPerSponsor: |
        select tabnucleifull.rif_nucleo as rifNucleo,
        tabistanza.rif_tipoIstanza as rifTipoIstanza,
        tabsoggetto.nome,
        tabsoggetto.cognome,
        tabsoggetto.email,
        tabsoggetto.enteAppartenenza,
        tabsoggetto.fototessera,
        tabsoggetto.nascitaData,
        tabsoggetto.nascitaLuogo,
        tabsoggetto.nazionalita,
        tabsoggetto.rif_gradoQualifica as rifGradoQualifica,
        tabsoggetto.rif_posizione as rifPosizione,
        tabsoggetto.rif_rapporto as rifRapporto,
        tabsoggetto.sesso,
        tabsoggetto.telCellulare,
        tabsoggetto.telUfficio,
        tabsoggetto.codiceFiscale,
        tabnucleifull.is_sponsor as isSponsor,
        tabistanza.rif_statoIstanza as rifStatoIstanza,
        tabcartaesercito.numeroCarta,
        tabcartaesercito.rif_statoCarta as rifStatoCarta,
        tabcartaesercito.dataScadenzaCarta,
        tabcartaesercito.dataRilascioCarta,
        tabsoggetto.rif_stato as rifStato,
        tabmandato.idMandato as numeroMandato,
        tabmandato.attestazionePagamento as croMandato,
        tabmandato.rif_statoMandato as rifStatoMandato,
        tabmandato.quotaMandato,
        tabmandato.rif_nucleofull as rifNucleoFull,
        tabmandato.dataMandato,
        tabMandatoPVC.idmandatopvc as numeroMandatoPVC,
        tabMandatoPVC.attestazionePagamento as croMandatoPVC,
        tabMandatoPVC.rifstatomandatopvc as rifStatoMandatoPVC,
        tabMandatoPVC.quotamandato as quotaMandatoPVC,
        tabMandatoPVC.rifnucleofull as rifNucleoFullPVC,
        tabMandatoPVC.datamandatopvc as dataMandatoPVC
        from tabnucleifull
          join tabistanza on tabistanza.idIstanza = tabnucleifull.rif_istanza
          join tabsoggetto on tabsoggetto.idSoggetto = tabnucleifull.rif_soggetto
          left join tabcartaesercito on tabnucleifull.rif_soggetto = tabcartaesercito.rif_soggetto
          left outer join tabmandato on tabmandato.rif_nucleofull = tabnucleifull.id and (tabmandato.rif_statoMandato = 1 or tabmandato.rif_statoMandato = null)
          left outer join tabMandatoPVC on tabMandatoPVC.rifnucleofull = tabnucleifull.id and (tabMandatoPVC.rifStatoMandatoPVC = 1 or tabMandatoPVC.rifStatoMandatoPVC = null)
        where tabistanza.id_sponsor = (select tabsoggetto.idSoggetto from tabsoggetto where tabsoggetto.codiceFiscale=:codiceFiscale);

      mandatiPerSponsor: |
        select tabmandato.idMandato,
        tabmandato.rif_statoMandato as rifStatoMandato,
        tabmandato.rif_nucleofull as rifNucleoFull,
        tabmandato.quotaMandato,
        tabmandato.dataMandato,
        tabmandato.dataEmissione,
        tabmandato.dataScadenza,
        tabmandato.rif_sponsor as rifSponsor,
        tabmandato.nota,
        tabmandato.notaConvalida,
        tabmandato.notaAnnullamento,
        tabmandato.dataAggiornamento,
        tabmandato.convalidaMandatoCovid,
        tabmandato.attestazionePagamento
        from tabmandato
        where tabmandato.rif_sponsor = 
        (select tabsoggetto.idSoggetto from tabsoggetto where tabsoggetto.codiceFiscale =:codiceFiscale) AND tabmandato.rif_statoMandato = 1;

      mandatiPVCPerSponsor: |
        select tabMandatoPVC.idmandatopvc,
        tabMandatoPVC.rifnucleofull            as rifnucleofullPvc,
        tabMandatoPVC.quotamandato             as quotamandatoPvc,
        tabMandatoPVC.rifsponsor               as rifsponsorPvc,
        tabMandatoPVC.note                     as notePvc,
        tabMandatoPVC.notaconvalida            as notaconvalidaPvc,
        tabMandatoPVC.notaannullamento         as notaannullamentoPvc,
        tabMandatoPVC.rifstatomandatopvc       as rifstatomandatoPvc,
        tabMandatoPVC.dataaggiornamento        as dataaggiornamentoPvc,
        tabMandatoPVC.datamandatopvc           as datamandatoPvc,
        tabMandatoPVC.dataemissionepvc         as dataemissionePvc,
        tabMandatoPVC.riftipomandato           as riftipomandatoPvc,
        tabMandatoPVC.attestazionePagamento
        from tabMandatoPVC
        where tabMandatoPVC.rifSponsor =
        (select tabsoggetto.idSoggetto from tabsoggetto where tabsoggetto.codiceFiscale =:codiceFiscale)  AND tabMandatoPVC.rifStatoMandatoPVC = 1;

