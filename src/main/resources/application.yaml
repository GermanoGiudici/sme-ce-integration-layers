spring:
  datasource:
    driver-class-name: org.mariadb.jdbc.Driver
    username: root
    url: jdbc:mariadb://localhost:3306/cartaesercito
    password: Entando2022
  jpa:
    hibernate:
      naming:
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
      ddl-auto: validate
app:
  bo-protocol-config:
    soggettoRifStato: 1
    istanzaRifCanale: 1
    istanzaRifOperatore: 1
    istanzaRifStatoIstanza: 1
    instanzaNucleoPrincipale: 1
    instanzaItegrNucleoPrincipale: 3
    instanzaNucleoEsterno: 4
    instanzaIntegrNucleoEsterno: 5
    instanzaRinnovoCE: 2

    mandatoRifOperatore:
    mandatoRifOperatorePagamento:
    mandatoRifStatoMandato:
    mandatoRifTipoPagamento:
  csv:
    folder: /Users/germano/projects/SME/sme-ce-integration-layers/files/
  query:
    nucleoFamiliarePrincipaleSponsor: |
      select * from tabnucleifull
      join tabsoggetto on tabnucleifull.rif_soggetto=tabsoggetto.idSoggetto
      where rif_istanza = 
      (select idIstanza from tabistanza 
      where id_sponsor=(select idSoggetto from tabsoggetto where codiceFiscale=:codiceFiscale)
      and rif_tipoIstanza in (1, 3) ORDER BY idIstanza DESC LIMIT 1);
    nucleoFamiliareEsternoSponsor: |
      select * from tabnucleifull
      join tabsoggetto on tabnucleifull.rif_soggetto=tabsoggetto.idSoggetto
      where rif_istanza = 
      (select idIstanza from tabistanza 
      where id_sponsor=(select idSoggetto from tabsoggetto where codiceFiscale=:codiceFiscale)
      and rif_tipoIstanza in (4, 5) ORDER BY idIstanza DESC LIMIT 1);
    cartaEsercitoPerSoggettiNucleoPrincipale: |
      select *
      from tabcartaesercito
      join tabnucleifull on tabcartaesercito.rif_nucleofull = tabnucleifull.id
      join tabistanza on tabnucleifull.rif_istanza = tabistanza.idIstanza
      join tabsoggetto on tabcartaesercito.rif_soggetto = tabsoggetto.idSoggetto
      where tabistanza.idIstanza = (select idIstanza
      from tabistanza
      where id_sponsor =
      (select idSoggetto from tabsoggetto where codiceFiscale = 'GDFGMN70D16H501T')
      and rif_tipoIstanza in (1, 3)
      ORDER BY idIstanza DESC
      LIMIT 1);
    cartaEsercitoPerSoggettiNucleoEsterno: |
      select *
      from tabcartaesercito
      join tabnucleifull on tabcartaesercito.rif_nucleofull = tabnucleifull.id
      join tabistanza on tabnucleifull.rif_istanza = tabistanza.idIstanza
      join tabsoggetto on tabcartaesercito.rif_soggetto = tabsoggetto.idSoggetto
      where tabistanza.idIstanza = (select idIstanza
      from tabistanza
      where id_sponsor =
      (select idSoggetto from tabsoggetto where codiceFiscale = 'GDFGMN70D16H501T')
      and rif_tipoIstanza in (4, 5)
      ORDER BY idIstanza DESC
      LIMIT 1);
    carteEsercitoPerSponsor: |
      select tabnucleifull.rif_nucleo,
       tabistanza.rif_tipoIstanza,
       tabsoggetto.nome,
       tabsoggetto.cognome,
       tabistanza.rif_statoIstanza,
       tabcartaesercito.rif_statoCarta,
       tabcartaesercito.dataScadenzaCarta
      from tabnucleifull
         join tabistanza on tabistanza.idIstanza = tabnucleifull.rif_istanza
         join tabsoggetto on tabsoggetto.idSoggetto = tabnucleifull.rif_soggetto
         left join tabcartaesercito on tabnucleifull.rif_soggetto = tabcartaesercito.rif_soggetto
      where tabistanza.id_sponsor = (select tabsoggetto.idSoggetto from tabsoggetto where tabsoggetto.codiceFiscale=:codiceFiscale)

